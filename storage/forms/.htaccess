# =================================================================
# Forms Storage Protection
# .htaccess file for securing uploaded files directory
# =================================================================

# Disable directory browsing
Options -Indexes

# Block access to all files by default
Order Deny,Allow
Deny from all

# Allow access only to specific file types (images and documents)
<FilesMatch "\.(jpg|jpeg|png|gif|pdf|doc|docx|txt|csv|xlsx|xls)$">
    Order Allow,Deny
    Allow from all
</FilesMatch>

# Block access to sensitive files
<FilesMatch "\.(php|php3|php4|php5|phtml|pl|py|jsp|asp|sh|cgi)$">
    Order Deny,Allow
    Deny from all
</FilesMatch>

# Security headers
<IfModule mod_headers.c>
    # Prevent MIME type sniffing
    Header set X-Content-Type-Options "nosniff"
    
    # Enable XSS protection
    Header set X-XSS-Protection "1; mode=block"
    
    # Prevent framing (clickjacking protection)
    Header set X-Frame-Options "SAMEORIGIN"
    
    # Set Content-Security-Policy for uploaded files
    Header set Content-Security-Policy "default-src 'none'; img-src 'self'; object-src 'none'; media-src 'self'; frame-src 'none'"
</IfModule>

# Remove server signature
ServerSignature Off

# Prevent access to .htaccess itself
<Files .htaccess>
    Order allow,deny
    Deny from all
</Files>

# Log access attempts (optional - for monitoring)
# RewriteEngine On
# RewriteCond %{REQUEST_FILENAME} !-f
# RewriteCond %{REQUEST_FILENAME} !-d
# RewriteRule ^(.*)$ /access_denied.html [L]

# Maximum file size for uploads (10MB)
php_value upload_max_filesize 10M
php_value post_max_size 10M
php_value max_execution_time 300
php_value max_input_time 300

# Block suspicious user agents
RewriteEngine On
RewriteCond %{HTTP_USER_AGENT} ^$ [OR]
RewriteCond %{HTTP_USER_AGENT} ^(-|\.|') [OR]
RewriteCond %{HTTP_USER_AGENT} ^(.*)(<|>|%0A|%0D|%27|%3C|%3E|%00) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(.*)(<|>|%0A|%0D|%27|%3C|%3E|%00) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(java|curl|wget) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(.*)(libwww-perl|GetRight|GetWeb!Go!|GetSmart!|Go!Zilla|Go-Ahead-Got-It|GrabNet|TurnitinBot) [NC,OR]
RewriteCond %{HTTP_USER_AGENT} ^(.*)(craftbot|download|stripper|sucker|ninja|clshttp|webspider|leacher|collector|grabber|webpictures) [NC]
RewriteRule ^(.*)$ - [F,L]