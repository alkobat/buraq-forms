# نظام التوجيه والمسارات الموحد (Routing & Path System)

تم تحديث نظام التوجيه وإدارة المسارات في مشروع `buraq-forms` ليكون أكثر مركزية، أماناً، وسهولة في الصيانة.

## 1. الثوابت العامة (Global Constants)

تم تعريف ثوابت للمسارات الرئيسية في `config/constants.php`، ويجب استخدامها بدلاً من المسارات النسبية (`../../`).

| الثابت | الوصف | مثال للقيمة |
|--------|-------|-------------|
| `BASE_PATH` | المسار الجذري للمشروع | `/var/www/project` |
| `PUBLIC_PATH` | مسار المجلد العام | `/var/www/project/public` |
| `CONFIG_PATH` | مسار مجلد الإعدادات | `/var/www/project/config` |
| `SRC_PATH` | مسار مجلد الكود المصدري | `/var/www/project/src` |
| `STORAGE_PATH` | مسار التخزين | `/var/www/project/storage` |
| `APP_URL` | رابط الموقع الأساسي | `http://localhost/project` |

### مثال للاستخدام:
```php
// السابق (تجنب هذا)
require_once __DIR__ . '/../../src/helpers.php';

// الحالي (استخدم هذا)
require_once SRC_PATH . '/helpers.php';
```

## 2. نظام التوجيه (Routing)

يتم الآن توجيه جميع الطلبات عبر `public/index.php` باستخدام `Router` class.

### ملف تعريف المسارات
المسارات معرفة في `config/routes.php`. لإضافة صفحة جديدة، أضفها إلى المصفوفة:

```php
return [
    '/login' => 'login.php',
    '/admin/dashboard' => 'admin/dashboard.php',
    // ...
];
```

### كيفية العمل
1. يقوم ملف `.htaccess` بتوجيه جميع طلبات `.php` والمسارات غير الموجودة إلى `index.php`.
2. يقوم `index.php` بتحميل الثوابت وبدء الـ `Router`.
3. يتحقق `Router` من المسار ويقوم بتضمين الملف المناسب.

### الوصول المباشر
لضمان التوافق، ما زالت الملفات موجودة في أماكنها، لكن يفضل استخدام المسارات النظيفة (بدون `.php`).
تم تحديث جميع الملفات لتستخدم `SRC_PATH` و `CONFIG_PATH` لضمان عملها سواء تم استدعاؤها عبر الراوتر أو بشكل مباشر (مع أن `index.php` هو المدخل المفضل).

## 3. معالجة الأخطاء (Error Handling)

تم إضافة صفحات خطأ مخصصة:
- `public/errors/404.php`: للصفحات غير الموجودة.
- `public/errors/500.php`: لأخطاء الخادم.

يقوم الراوتر بعرض هذه الصفحات تلقائياً عند حدوث خطأ.

## 4. ملفات .htaccess

تم تحسين `public/.htaccess` ليكون:
- **ديناميكياً**: لا يعتمد على `RewriteBase` ثابت.
- **آمناً**: يمنع الوصول للملفات الحساسة (`.env`, `composer.json`).
- **شاملاً**: يوجه جميع الطلبات إلى `index.php` لضمان تحميل الثوابت.

## خطوات إضافة صفحة جديدة

1. أنشئ الملف في المكان المناسب (مثلاً `public/admin/new-page.php`).
2. استخدم الثوابت `SRC_PATH` لتضمين الملفات المطلوبة.
3. أضف المسار في `config/routes.php`:
   ```php
   '/admin/new-page' => 'admin/new-page.php',
   ```
4. يمكنك الوصول للصفحة عبر `http://your-site/admin/new-page`.
